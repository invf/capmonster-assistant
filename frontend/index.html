<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CapMonsterCloud ‚Äî Assistant</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root {
  --bg: #0a192f;
  --card: #112240;
  --accent: #64ffda;
  --text: #e0e0e0;
  --text2: #7a869a;
}
body {
  background: var(--tg-theme-bg-color, var(--bg));
  color: var(--tg-theme-text-color, var(--text));
  font-family: 'Segoe UI', sans-serif;
  text-align: center;
  margin: 0;
}
h1 {
  color: var(--tg-theme-button-color, var(--accent));
  margin: 25px 10px 10px;
  font-size: 1.4em;
}
p { margin: 10px 0; font-size: 0.95em; }

input, button {
  padding: 10px;
  border-radius: 6px;
  border: none;
  margin: 5px;
  font-size: 1em;
}
input {
  width: 90%;
  max-width: 340px;
  background: #1b2a47;
  color: var(--text);
  border: 1px solid #2e3b5c;
}
button {
  background: var(--tg-theme-button-color, var(--accent));
  color: var(--tg-theme-button-text-color, #0a192f);
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
button:hover { opacity: 0.9; }

/* Dashboard */
.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  padding: 20px;
  max-width: 1200px;
  margin: auto;
}
.card {
  background: var(--card);
  border-radius: 12px;
  padding: 20px;
  border: 1px solid rgba(100,255,218,0.25);
  box-shadow: 0 2px 10px rgba(100,255,218,0.05),
              0 0 6px rgba(255,255,255,0.05);
  transition: transform .25s, box-shadow .25s, border .25s;
}
.card:hover {
  transform: scale(1.03);
  border: 1px solid rgba(100,255,218,0.6);
  box-shadow: 0 4px 14px rgba(100,255,218,0.25),
              0 0 12px rgba(100,255,218,0.15);
}
.card h3 {
  color: var(--tg-theme-button-color, var(--accent));
  margin: 0 0 10px 0;
}
.value { font-size: 22px; font-weight: bold; color: #80ffea; margin: 10px 0; }
.btns { margin-top: 10px; display: flex; justify-content: center; gap: 6px; flex-wrap: wrap; }
.btn {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 6px;
  text-decoration: none;
  font-weight: bold;
  font-size: 0.9em;
}
.demo { background: var(--accent); color: #0a192f; }
.docs {
  background: #1b2a47;
  color: var(--accent);
  border: 1px solid var(--accent);
}
.demo:hover { opacity: 0.9; }
.docs:hover { background: var(--accent); color: #0a192f; }

/* Modals */
#overlay, #welcomeOverlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.85);
  z-index: 999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  text-align: center;
}
#welcomeOverlay h2 { color: var(--accent); }
#welcomeOverlay p {
  max-width: 400px;
  margin: 10px auto;
  color: #ccc;
}
#welcomeOverlay a {
  color: var(--accent);
  text-decoration: none;
  font-weight: bold;
}
.modal {
  background: var(--card);
  border: 2px solid var(--accent);
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(100,255,218,0.3);
  padding: 15px;
  width: 95%;
  max-width: 380px;
  text-align: center;
  animation: fadeIn 0.3s ease;
}
.modal img {
  width: 100%;
  max-height: 70vh;
  object-fit: contain;
  border-radius: 10px;
  margin-top: 10px;
}
button.close {
  background: var(--accent);
  color: #0a192f;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  margin-top: 15px;
}
button.close:hover { opacity: 0.9; }

footer { margin: 20px; color: var(--text2); font-size: 0.8em; }
@keyframes fadeIn { from{opacity:0;transform:translateY(-10px);} to{opacity:1;transform:translateY(0);} }

@media (max-width: 700px) {
  .dashboard { display: flex; flex-direction: column; align-items: center; gap: 10px; }
  .card { width: 90%; max-width: 380px; }
}
</style>
</head>
<body>

<h1>üß† CapMonsterCloud ‚Äî Assistant</h1>
<p>Enter your API key</p>

<input id="apiKey" placeholder="Enter your CapMonster API key">
<button onclick="checkBalance()">Check Balance</button>

<h2 id="balanceDisplay">‚Äî</h2>
<div id="dashboard" class="dashboard"></div>

<!-- Demo Modal -->
<div id="overlay">
  <div class="modal">
    <h2 id="ovTitle">Demo</h2>
    <img id="demoImg" src="">
    <button class="close" onclick="closeOverlay()">Close</button>
  </div>
</div>

<!-- Welcome Modal -->
<div id="welcomeOverlay">
  <div class="modal">
    <h2>üîë Get your CapMonster API key</h2>
    <p>
      To get full access to the assistant, create an account on
      <a href="https://capmonster.cloud/en/" target="_blank">CapMonster.Cloud</a>
      and generate your API key.
    </p>
    <button onclick="goToDemoMode()">Continue in demo mode</button>
  </div>
</div>

<footer>Data based on approximate prices | ¬© 2025 CapMonster Assistant</footer>

<script>
const API_URL="http://127.0.0.1:8000/get_balance";
let captchas=[];

window.onload=async()=>{
 await loadPrices();
 const savedKey=localStorage.getItem("capKey");
 if(!savedKey){
   document.getElementById('welcomeOverlay').style.display='flex';
 } else {
   document.getElementById('apiKey').value=savedKey;
   checkBalance(false);
 }

 if(window.Telegram && window.Telegram.WebApp){
   Telegram.WebApp.ready();
   Telegram.WebApp.expand();
 }
};

async function loadPrices(){
 try{
  const res=await fetch("prices.json");
  captchas=await res.json();
 }catch(e){ console.error("‚ùå Cannot load prices.json",e); }
}

async function checkBalance(save=true){
 const key=document.getElementById('apiKey').value.trim();
 if(!key){alert("Enter your API key");return;}
 if(save) localStorage.setItem("capKey",key);
 document.getElementById('balanceDisplay').innerText="‚è≥ Checking balance...";
 const fd=new FormData();fd.append("clientKey",key);
 try{
  const res=await fetch(API_URL,{method:"POST",body:fd});
  const data=await res.json();
  if(data.balance){
    const balance=data.balance;
    document.getElementById('balanceDisplay').innerHTML=`üí∞ Balance: <b>$${balance.toFixed(3)}</b>`;
    renderDashboard(balance);
  } else {
    document.getElementById('balanceDisplay').innerHTML=`‚ùå ${data.error||'Invalid response'}`;
  }
 }catch(e){
  document.getElementById('balanceDisplay').innerText="‚ùå Connection error";
  console.error(e);
 }
}

function renderDashboard(balance){
 const dash=document.getElementById('dashboard');
 dash.innerHTML="";
 captchas.forEach(c=>{
  const solves=Math.floor(balance/c.price);
  dash.innerHTML+=`
   <div class="card">
    <h3>${c.name}</h3>
    <div class="value">${solves.toLocaleString()} solves</div>
    <div>at $${c.price.toFixed(4)} per solve</div>
    <div class="btns">
      <a href="#" class="btn demo" onclick="openDemo('${c.name}','${c.gif}')">üß© Demo</a>
      <a class="btn docs" href="${c.docs}" target="_blank">üìò Docs</a>
    </div>
   </div>`;
 });
}

function openDemo(name,url){
 const overlay=document.getElementById('overlay');
 document.getElementById('ovTitle').textContent=name+" Demo";
 document.getElementById('demoImg').src=url;
 overlay.style.display="flex";
}
function closeOverlay(){
 document.getElementById('overlay').style.display="none";
 document.getElementById('demoImg').src="";
}

/* --- DEMO MODE --- */
function goToDemoMode(){
 document.getElementById('welcomeOverlay').style.display='none';
 document.getElementById('balanceDisplay').innerHTML="üí∞ Balance: <b>$0.000</b>";
 renderDashboard(0); 
}
</script>
</body>
</html>
